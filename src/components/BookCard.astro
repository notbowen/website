---
import type { CollectionEntry } from "astro:content";
import { Image } from "astro:assets";

type Props = {
    entry: CollectionEntry<"books">;
};

const { entry } = Astro.props;

const statusEmoji = {
    planning: "ðŸ“…",
    reading: "ðŸ“–",
    completed: "âœ…",
};

const statusText = {
    planning: "Plan to Read",
    reading: "Reading",
    completed: "Finished",
};
---

<a
    href={`${entry.data.link}`}
    target="_blank"
    class="flex flex-col gap-y-3 text-start w-fit max-w-[160px] group h-full"
>
    {
        entry.data.img && (
            <div class="w-[160px] h-[240px] relative">
                {typeof entry.data.img === "string" ? (
                    <img
                        src={entry.data.img}
                        alt={entry.data.title}
                        class="w-full h-full rounded-lg shadow-md object-cover"
                    />
                ) : (
                    <Image
                        src={entry.data.img}
                        alt={entry.data.title}
                        class="w-full h-full rounded-lg shadow-md object-cover"
                    />
                )}
            </div>
        )
    }

    {
        !entry.data.img && (
            <div class="w-[160px] h-[240px] bg-black/5 dark:bg-white/5 rounded-lg shadow-md flex items-center justify-center">
                <span class="text-4xl">ðŸ“š</span>
            </div>
        )
    }

    <div class="flex flex-col gap-y-1 max-w-[160px]">
        <div
            class="font-semibold text-black dark:text-white leading-tight line-clamp-2"
        >
            {entry.data.title}
        </div>
        <div class="text-sm text-black/60 dark:text-white/60 line-clamp-1">
            {entry.data.author}
        </div>
        <div
            class="text-xs text-black/40 dark:text-white/40 flex gap-1 items-center mt-1"
        >
            <span>{statusEmoji[entry.data.status]}</span>
            <span>{statusText[entry.data.status]}</span>
            {
                (entry.data.status === "reading" ||
                    entry.data.status === "planning" ||
                    (entry.data.status === "completed" &&
                        entry.data.dateRead)) && (
                    <>
                        <span>â€¢</span>
                        <span>
                            {entry.data.status === "reading"
                                ? "Present"
                                : entry.data.status === "planning"
                                  ? "Future"
                                  : entry.data.dateRead?.toLocaleDateString(
                                        "en-US",
                                        {
                                            year: "numeric",
                                            month: "short",
                                        },
                                    )}
                        </span>
                    </>
                )
            }
        </div>
    </div>
</a>
